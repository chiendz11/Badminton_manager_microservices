generator client {
Â  provider = "prisma-client-js"
}

datasource db {
Â  provider = "postgresql"
Â  urlÂ  Â  Â  = env("DATABASE_URL")
}

// ğŸ’¡ ÄÃƒ Cáº¬P NHáº¬T 3 VAI TRÃ’
enum Role {
Â  USER 
Â  CENTER_MANAGER
Â  SUPER_ADMIN
}

model User {
Â  // ğŸ”‘ ID CHÃNH: ThÃªm @db.Uuid
Â  idÂ  Â  Â  Â  Â  Â  Â  Â  Â  Â  StringÂ  Â  Â  Â  Â  Â  Â  @id @default(uuid()) @db.Uuid
// Äá»‹nh dáº¡ng: USER-uuidv4(). DÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i cÃ¡c Service khÃ¡c.
  publicUserId          String? @unique @db.VarChar(50) // Dáº¥u '?' lÃ  chÃ¬a khÃ³a
Â  emailÂ  Â  Â  Â  Â  Â  Â  Â  Â StringÂ  Â  Â  Â  Â  Â  Â  @unique
Â  usernameÂ  Â  Â  Â  Â  Â  Â  String?Â  Â  Â  Â  Â  Â  Â @unique
Â  roleÂ  Â  Â  Â  Â  Â  Â  Â  Â  RoleÂ  Â  Â  Â  Â  Â  Â  Â  @default(USER)
Â Â 
Â  passwordHashÂ  Â  Â  Â  Â  String?Â  Â  Â  Â  Â  Â  Â 
Â Â 
Â  isActiveÂ  Â  Â  Â  Â  Â  Â  BooleanÂ  Â  Â  Â  Â  Â  Â @default(true)
Â  isVerifiedÂ  Â  Â  Â  Â  Â  BooleanÂ  Â  Â  Â  Â  Â  Â @default(false)

Â  // ğŸ’¡ TRÆ¯á»œNG ÄÃƒ CÃ“: Sá»‘ láº§n Ä‘Äƒng nháº­p tháº¥t báº¡i liÃªn tiáº¿p (dÃ¹ng Ä‘á»ƒ Ä‘áº¿m)
Â  failedLoginAttemptsÂ  Â IntÂ  Â  Â  Â  Â  Â  Â  Â  Â @default(0)Â 

Â  // ğŸ’¡ TRÆ¯á»œNG Cáº¦N THÃŠM: Thá»i Ä‘iá»ƒm tÃ i khoáº£n bá»‹ khÃ³a cho Ä‘áº¿n khi nÃ o (náº¿u bá»‹ khÃ³a)
Â  lockoutUntilÂ  Â  Â  Â  Â  DateTime?Â  Â  Â  Â  Â  Â 
Â Â 
Â  createdAtÂ  Â  Â  Â  Â  Â  Â DateTimeÂ  Â  Â  Â  Â  Â  @default(now())
Â  updatedAtÂ  Â  Â  Â  Â  Â  Â DateTimeÂ  Â  Â  Â  Â  Â  @updatedAt

Â  externalIdentitiesÂ  Â  ExternalIdentity[]Â Â 
Â  sessionsÂ  Â  Â  Â  Â  Â  Â  Session[]
Â  refreshTokensÂ  Â  Â  Â  Â RefreshToken[]
Â  verificationTokensÂ  Â VerificationToken[]
}

model Session {
Â  // ğŸ”‘ ID: ThÃªm @db.Uuid
Â  idÂ  Â  Â  Â  StringÂ  Â @id @default(uuid()) @db.Uuid
Â  // ğŸ”‘ KhÃ³a Ngoáº¡i: ThÃªm @db.Uuid
Â  userIdÂ  Â  String @db.Uuid
Â  userÂ  Â  Â  UserÂ  Â  Â @relation(fields: [userId], references: [id], onDelete: Cascade) // ğŸ’¡ ThÃªm onDelete
Â  ipAddress String?
Â  userAgent String?
Â  createdAt DateTime @default(now())
Â  expiresAt DateTime
}Â 

model RefreshToken {
Â  // ğŸ”‘ ID: ThÃªm @db.Uuid
Â  idÂ  Â  Â  Â  StringÂ  Â @id @default(uuid()) @db.Uuid
Â  // ğŸ”‘ KhÃ³a Ngoáº¡i: ThÃªm @db.Uuid
Â  userIdÂ  Â  String @db.Uuid
Â  userÂ  Â  Â  UserÂ  Â  Â @relation(fields: [userId], references: [id], onDelete: Cascade) // ğŸ’¡ ThÃªm onDelete
Â  tokenÂ  Â  Â StringÂ  Â @unique
Â  expiresAt DateTime
Â  createdAt DateTime @default(now())
}

model ExternalIdentity {
Â  // ğŸ”‘ ID: ThÃªm @db.Uuid
Â  idÂ  Â  Â  Â  Â  Â  Â  Â  StringÂ  Â  @id @default(uuid()) @db.Uuid
Â  // ğŸ”‘ KhÃ³a Ngoáº¡i: ThÃªm @db.Uuid
Â  userIdÂ  Â  Â  Â  Â  Â  String @db.Uuid
Â  userÂ  Â  Â  Â  Â  Â  Â  UserÂ  Â  Â  @relation(fields: [userId], references: [id], onDelete: Cascade) // ğŸ’¡ ThÃªm onDelete
Â Â 
Â  providerNameÂ  Â  Â  StringÂ  Â Â 
Â  providerUserIdÂ  Â  StringÂ  Â Â 

Â  createdAtÂ  Â  Â  Â  Â DateTimeÂ  @default(now())

Â  @@unique([providerName, providerUserId])Â 
}

model VerificationToken {
Â  // ğŸ”‘ ID: ThÃªm @db.Uuid
Â  idÂ  Â  Â  Â  StringÂ  Â  @id @default(uuid()) @db.Uuid
Â  // ğŸ”‘ KhÃ³a Ngoáº¡i: ThÃªm @db.Uuid
Â  userIdÂ  Â  String @db.Uuid
Â  userÂ  Â  Â  UserÂ  Â  Â  @relation(fields: [userId], references: [id], onDelete: Cascade) // ğŸ’¡ ThÃªm onDelete
Â  tokenÂ  Â  Â StringÂ  Â  @unique // Token duy nháº¥t Ä‘Æ°á»£c gá»­i qua email
Â  expiresAt DateTime
Â  createdAt DateTimeÂ  @default(now())

Â  @@unique([userId, token])
}

model AuthClient {
Â  idÂ  Â  Â  Â  Â  Â StringÂ  Â @id @default(uuid()) @db.Uuid
Â  nameÂ  Â  Â  Â  Â StringÂ  Â @unique
Â  clientIdÂ  Â  Â StringÂ  Â @unique // Äá»‹nh danh cho Admin UI (vÃ­ dá»¥: 'admin-app') hoáº·c S2S
Â  clientSecret String
Â  isActiveÂ  Â  Â BooleanÂ  @default(true)
Â  
  // ğŸ’¡ TRÆ¯á»œNG Má»šI: Äá»‹nh nghÄ©a cÃ¡c Role Ä‘Æ°á»£c phÃ©p Ä‘Äƒng nháº­p vÃ o Client nÃ y
  allowedRoles Role[]   @default([]) 
Â  
Â  createdAtÂ  Â  DateTime @default(now())
Â  updatedAtÂ  Â  DateTime @updatedAt
}