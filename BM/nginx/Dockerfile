# Sแปญ dแปฅng Image WAF chรญnh chแปง
FROM owasp/modsecurity-crs:nginx

# 1. Cแบฅu hรฌnh Nginx (Proxy)
COPY nginx.conf /etc/nginx/templates/conf.d/default.conf.template

# 2. ๐ก Cแบฅu hรฌnh WAF (Ghi ฤรจ luแบญt chแบทn nhแบงm)
# QUAN TRแปNG: Copy vรo thฦฐ mแปฅc rules vร ฤแบทt tรชn RESPONSE-999... 
# ฤแป ฤแบฃm bแบฃo nรณ chแบกy SAU cรกc luแบญt mแบทc ฤแปnh vร ghi ฤรจ ฤฦฐแปฃc chรบng.
COPY modsecurity-override.conf /opt/owasp-crs/rules/RESPONSE-999-exclusion.conf

# 3. Quyแปn hแบกn cho Log
USER root
RUN touch /var/log/modsec_audit.log && chown nginx:nginx /var/log/modsec_audit.log
USER nginx